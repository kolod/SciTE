<html>
<head>
<meta http-equiv=Content-Type Content="text-html; charset=windows-1251">
<meta http-equiv=MSThemeCompatible Content=Yes>
<hta:application
id=HELP
applicationName=html_HELP
icon=winhlp32.exe
maximizeButton=yes
innerBorder=no
scroll=no
selection=yes
contextMenu=yes
singleinstance=yes
version=1.0
>
<script language=JavaScript>
function Shortcuts(key, pane){
	if (pane == 0){
		var pane = self;
	} else {
		var pane = parent;
	}
	switch(key){
		case 116:  // F5 - отменяем рефреш
			pane.event.cancelBubble = true;
			pane.event.returnValue = false;
			return(false);
			break;
		case 27: //Esc - выход
			pane.window.close(true);
			break;
		case 114: //F3 - следующее вхождение
			pane.Search(pane.sSearch.value);
			break;
	}
	return;
}

document.onkeydown = function(){Shortcuts(event.keyCode, 0)}

function html_doc_onkeydown(){
	Shortcuts(html_doc.event.keyCode, 1);
}
</script>
<style type="text/css">
body, table {font-family:MS Sans Serif; font-size:8px; background-color:threedface; cursor:default; margin:0px;}
input {font-family:MS Sans Serif; font-size:8px;}
</style>
<title>html HELP</title>
</head><body>
<table width="100%" cellpadding="0" cellspacing="0" border="0">
	<tr>
		<td align="right">
			<font color="#000080">Find:</font>&nbsp;&nbsp;<INPUT name=sSearch TYPE=text value="" style="width:30%" onClick="SearchReset();">&nbsp;&nbsp;<INPUT style="color:#000080" NAME="btnSearch" TYPE="button" Value="Search" onClick="Search(sSearch.value)" title="Find Next [F3]">&nbsp;&nbsp;
		</td>
	</tr>
</table>
<script language=JavaScript>
// Читаем аргументы ком.строки
var cmd = HELP.commandLine;
var re=/"(.*?)"/g;
var Arr_cmd = re.exec(cmd);
Arr_cmd = re.exec(cmd);
if (Arr_cmd) {
	var help_path = Arr_cmd[1];
	var text_find = "";
	Arr_cmd = re.exec(cmd);
	if (Arr_cmd) {
		text_find = Arr_cmd[1];
		sSearch.value = text_find;
	}
} else {
	alert ('Command line:\n html_HELP.hta "c:\\path\\doc.html" "find_string"');
	window.close(false);
}

var find_num=0;
var find_num_max=0;
var r;

function Search(s){
//.Поиск в IFRAME
	if (s!='') {
		var sgoto = 'Go to ';
		if (btnSearch.value=='Search'){
			var i;
			r = html_doc.document.body.createTextRange();
			r.execCommand('BackColor','','');
			for(i=0;r.findText(s);i++){
				r.execCommand('BackColor','','yellow');
				r.execCommand('CreateBookmark','','bmk'+i);
				r.collapse(false);
			}
			if (i==0) {btnSearch.value='Not Found';btnSearch.style.color="red";}
			else {btnSearch.value=sgoto + (find_num+1) + ' (in '+ i +')'; find_num_max=i;}
		} else {
			if (find_num_max != 0){
				if (find_num==0){
					r = html_doc.document.body.createTextRange();
				}
				r.findText(s);
				r.select();
				r.collapse(false);
				find_num++;
				if (find_num>=find_num_max){find_num=0}
				btnSearch.value=sgoto + (find_num+1) + ' (in '+ find_num_max +')';
			}
		}
	}
}

function SearchReset(){
	//.Сброс поиска
	sSearch.value='';
	btnSearch.value='Search';
	btnSearch.style.color="#000080";
}

function on_load() {
	html_doc.document.onkeydown = function() {parent.html_doc_onkeydown()};
	document.title = html_doc.document.title + " - " + HELP.applicationName.replace(/_/g,' ') + ' ' + HELP.version;
	Search(sSearch.value);
	Search(sSearch.value);
}

document.write('<div style="width:100%; height:100%;"><IFRAME onLoad="on_load();" id="html_doc" src="'+help_path+'" width="100%" height="100%" style="padding-bottom:20px;"><\/IFRAME><\/div>');
</script>
</body>
</html>

<html>
<head>
<meta http-equiv=MSThemeCompatible Content=Yes>
<hta:application
id=CI_VIEW
applicationName=CI_Viewer
maximizeButton=no
border=dialog
innerBorder=yes
borderStyle=raised
scroll=no
selection=no
contextMenu=no
caption=no
showInTaskBar=no
singleinstance=yes
version=1.1
>
<title>CI Viewer</title>
<style type="text/css">
	body {
		font:normal normal 10px Arial;
		margin:0;
	}
</style>
<script language="JavaScript">
	try {
		var SciTE=new ActiveXObject("SciTE.Helper");
	} catch(e) {
		alert("Please install SciTE Helper before!");
	}

	function show() {
		// Считываем значение параметра "civiewer.value"
		// и пытаемся его отобразить
		var current_value = SciTE.Props("civiewer.value");
		if (/^@/.test(current_value)) {
			// value содержит ссылку на изображение
			self.help.style.display="none";
			self.document.images.preview.style.display="inline";
			self.document.images.preview.src=current_value.replace(/^@/,'');
		} else {
			// value возможно содержит параметр цвета
			self.document.images.preview.style.display="none";
			try {
				self.document.body.style.backgroundColor=current_value;
				self.help.style.display="none";
			} catch(e) {
				self.document.body.style.backgroundColor="window";
				self.help.style.display="inline";
			}
		}
		// запускаем заново эту процедуру через указанное время
		setTimeout("show()",50);
	}
</script>
</head>
<body onLoad="SciTE.onTop(document.title, true);"><center>
<span id="help">Переместите курсор<br>
на параметр цвета<br>
("<font color="#6495ED">#6495ED</font>" или "<font color="red">red</font>")<br>
или на ссылку с изображением ("<a href="#">bg.gif</a>") <hr size="1">
Клик <b>левой</b> кнопкой закроет приложение.<br>
<b>Правая</b> - перемещение.</span>
	<img id="preview" style="width:100%;height:100%;display:none" src="" alt="This Not Image!">
</center></body>
<script language="JavaScript">
	// Инициализация окна приложения
	var view_width = 128;
	var view_height = 128;
	window.resizeTo(view_width, view_height);
	window.moveTo(SciTE.Left + SciTE.Width - view_width - 5, SciTE.Top + 25);
	show();
	SciTE.Focus();
	// Запуск в SciTE процедуры OnDwellStart, проверяющей положение курсора
	SciTE.Props("dwell.period")="50";
	SciTE.MenuCommand(416); // Другого способа включить OnDwellStart не нашел :(
	SciTE.MenuCommand(416);
	// SciTE.Send("property:dwell.period=500");

	// Изменение вида курсора при перетаскивании
	function cursor(c){
		for (var i in document.all) {
			try {document.all[i].style.cursor=c} catch(e) {}
		}
	}

	// Процедуры для закрытия и перемещения окна приложения
	var x0, y0;

	function WindowDragHandler() {
		if (event.button!=1){
			window.moveBy(event.x-x0, event.y-y0);
		}
	}

	document.onmousedown=function () {
		if (event.button!=1){
			// Если нажата не левая кнопка - перемещение окна
			x0=event.x; y0=event.y;
			document.onmousemove=WindowDragHandler;
			cursor("move");
		}else{
			// Если нажата левая кнопка - закрытие окна
			// Отключаем в SciTE процедуру OnDwellStart
			SciTE.Props("dwell.period")="";
			SciTE.MenuCommand(416); // Другого способа отключить OnDwellStart не нашел :(
			SciTE.MenuCommand(416);
			self.close();
		}
	}

	document.onmouseup=function () {
		document.onmousemove=null;
		cursor("auto");
	}

	document.mouseout=function () {
		document.onmousemove=null;
		cursor("auto");
	}
</script>
</html>